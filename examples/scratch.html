<html>
<head>
<title>Basic Geometry</title>
  <style>
    body { background: #fff; height: 100%; margin:0;}
    canvas { width: 100%; height: 100%}
  </style>
  <script src="../manifold.js"></script>
</head>
<body>
  <canvas id="c"></canvas>
</body>
  <script>

var M = manifold;
var canvas = document.getElementById('c');
canvas.width = canvas.offsetWidth;
canvas.height= canvas.offsetHeight;
var ctx = canvas.getContext('2d');

var c1 = [Math.random()*canvas.width, Math.random()*canvas.height, 0];
var c2 = [Math.random()*canvas.width, Math.random()*canvas.height, 0];
var c3 = [Math.random()*canvas.width, Math.random()*canvas.height, 0];
var c4 = [Math.random()*canvas.width, Math.random()*canvas.height, 0];
var c5 = [Math.random()*canvas.width, Math.random()*canvas.height, 0];

ctx.fillStyle = '#666';
ctx.beginPath();
ctx.arc(c1[0],c1[1],3,0,2*Math.PI,true);
ctx.fill();

ctx.beginPath();
ctx.arc(c5[0],c5[1],3,0,2*Math.PI,true);
ctx.fill();

ctx.strokeStyle = '#666';
ctx.lineWidth = .3;

ctx.beginPath();
ctx.moveTo(c1[0],c1[1]);
ctx.lineTo(c2[0],c2[1]);
ctx.stroke();

ctx.beginPath();
ctx.moveTo(c2[0],c2[1]);
ctx.lineTo(c3[0],c3[1]);
ctx.stroke();

ctx.beginPath();
ctx.moveTo(c3[0],c3[1]);
ctx.lineTo(c4[0],c4[1]);
ctx.stroke();

ctx.beginPath();
ctx.moveTo(c4[0],c4[1]);
ctx.lineTo(c5[0],c5[1]);
ctx.stroke();

ctx.strokeStyle = '#0cf';
ctx.lineWidth = 8;
ctx.beginPath();
ctx.moveTo(c1[0],c1[1]);
//ctx.bezierCurveTo(c2[0],c2[1],c3[0],c3[1],c4[0],c4[1]);
ctx.stroke();

ctx.strokeStyle = 'rgba(0,200,255,1)';
ctx.lineWidth = 2;
ctx.beginPath();
ctx.moveTo(c1[0],c1[1]);

function resolveCurve( points, s, start, size ) {
  start = start || 0;
  size = size || points.length;
  if ( size < 2 ) return points[start];

  var p1 = resolveCurve( points, s, start, size-1 ), p2 = resolveCurve( points, s, start+1, size-1 );
  return M.vadd( p1, M.vscale( M.vsub(p2, p1), s) );
}

var V1 = c1, V2 = M.vscale(M.vsub(c2,c1),3), V3 = M.vsub(M.vscale(M.vadd(c1,c3),3), M.vscale(c2,6)), 
    V4 = M.vsub(M.vadd(c4,M.vscale(c2,3)), M.vadd(M.vscale(c3,3),c1));
var delta = .01;
var dist = 01;
for (var s=delta, plast = c1; s<=1.0001; s+=delta) {
//  var p = M.vadd( V1, M.vadd( M.vscale(V2,s), M.vadd( M.vscale(V3,s*s), M.vscale(V4,s*s*s) )));
  var p = resolveCurve( [c1,c2,c3,c4,c5], s );
  ctx.lineTo(p[0],p[1]);
  dist += M.vlength(M.vsub(p,plast));
  plast = p;
}
ctx.stroke();

ctx.fillStyle = 'rgba(255,255,255,1)';
for (var s=.05; s<=1.0001; s+=.05) {
  var p = resolveCurve( [c1,c2,c3,c4,c5], s );
  ctx.beginPath();
  ctx.arc(p[0],p[1],2,0,2*Math.PI,true);
  ctx.fill();
}

console.log( dist )
console.log( M.vlength(V2) + M.vlength(V3) + M.vlength(V4) )

/*
var dists = [];
deltas = [.1,.05,.02,.01,.005,.002,.001,.0005,.0002,.0001,.00005,.00002,.00001];
for ( var j=0, delta; delta = deltas[j]; j++) {
  dists[j]=0;
  for (var s=delta, plast = c1; s<=1.000000001; s+=delta) {
    var p = M.vadd( V1, M.vadd( M.vscale(V2,s), M.vadd( M.vscale(V3,s*s), M.vscale(V4,s*s*s) )));
    dists[j] += M.vlength(M.vsub(p,plast));
    plast = p;
  }
  console.log(s-delta)
}

var best = dists[dists.length-1];
for (var i=0,delta; delta=deltas[i]; i++) {
  console.log( dists[i].toFixed(10), (Math.abs(dists[i]-best)/best).toFixed(10), delta);
}
*/

  </script><html>